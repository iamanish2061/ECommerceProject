<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Our Products</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">

<div class="max-w-7xl mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold text-gray-800 text-center mb-12">Our Products</h1>

    <!-- Loading State -->
    <div id="loading" class="text-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mx-auto"></div>
        <p class="mt-4 text-gray-600">Loading products...</p>
    </div>

    <!-- Error Message -->
    <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-lg mb-8 text-center"></div>

    <!-- Products Grid -->
    <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 hidden">
        <!-- Products will be injected here via JS -->
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden text-center py-20">
        <p class="text-2xl text-gray-500">No products available yet.</p>
    </div>
</div>

<script>
    // Fetch products from your API
    async function fetchProducts() {
      const loading = document.getElementById('loading');
      const errorMessage = document.getElementById('errorMessage');
      const productsGrid = document.getElementById('productsGrid');
      const emptyState = document.getElementById('emptyState');

      try {
        const response = await fetch('/api/products'); // Adjust endpoint if needed

        if (!response.ok) {
          throw new Error('Failed to fetch products');
        }

        const result = await response.json();

        if (!result.success) {
          throw new Error(result.message || 'Unknown error');
        }

        const products = result.data.products;

        // Clear previous content
        productsGrid.innerHTML = '';

        if (products.length === 0) {
          emptyState.classList.remove('hidden');
          return;
        }

        // Render each product
        products.forEach(product => {
          const card = document.createElement('div');
          card.className = 'bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-shadow duration-300';

          card.innerHTML = `
            <div class="relative aspect-w-1 aspect-h-1 bg-gray-200">
              ${product.imageUrl ? `
                <img src="${product.imageUrl}"
                     alt="${product.title}"
                     class="w-full h-64 object-cover"
                     loading="lazy"
                     onerror="this.src='https://via.placeholder.com/400x400?text=No+Image'; this.onerror=null;" />
              ` : `
                <div class="w-full h-64 bg-gray-300 flex items-center justify-center">
                  <span class="text-gray-500 text-lg">No Image</span>
                </div>
              `}
              ${product.stock <= 0 ? `
                <span class="absolute top-2 right-2 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-semibold">Out of Stock</span>
              ` : product.stock < 10 ? `
                <span class="absolute top-2 right-2 bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-semibold">Low Stock</span>
              ` : ''}
            </div>

            <div class="p-6">
              <h3 class="text-lg font-bold text-gray-800 line-clamp-2 mb-2">${product.title}</h3>

              ${product.shortDescription ? `
                <p class="text-gray-600 text-sm line-clamp-3 mb-4">${product.shortDescription}</p>
              ` : ''}

              <div class="flex items-center justify-between mt-4">
                <div>
                  ${product.price ? `
                    <span class="text-2xl font-bold text-blue-600">â‚¹${product.price}</span>
                  ` : `
                    <span class="text-gray-500 italic">Price not available</span>
                  `}
                </div>

                <div class="text-right">
                  <p class="text-sm text-gray-500">Stock: ${product.stock}</p>
                </div>
              </div>

              <a href="/products/${product.id}"
                 class="mt-6 block w-full text-center bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                View Details
              </a>
            </div>
          `;

          productsGrid.appendChild(card);
        });

        productsGrid.classList.remove('hidden');

      } catch (err) {
        console.error('Error fetching products:', err);
        errorMessage.textContent = err.message || 'Could not load products. Please try again later.';
        errorMessage.classList.remove('hidden');
      } finally {
        loading.classList.add('hidden');
      }
    }

    // Load products on page load
    document.addEventListener('DOMContentLoaded', fetchProducts);
</script>
</body>
</html>